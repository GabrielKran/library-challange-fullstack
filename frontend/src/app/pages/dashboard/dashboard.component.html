<div class="container">
  <header>
    <div class="header-left">
      <button class="hamburger-btn" (click)="toggleSidebar()">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
      <h1>ğŸ“š Biblioteca Central</h1>
    </div>
  </header>

 <section *ngIf="myReservations.length > 0" class="my-books-section">
    <h2>ğŸ“– Meus Livros Alugados</h2>
    <div class="grid">
      <div *ngFor="let res of myReservations" class="card active-loan">
        <div class="card-body">
          <h3>{{ res.book.title }}</h3>
          
          <p [class.status-late]="isLate(res.endDate)" 
             [class.status-ok]="!isLate(res.endDate)">
             {{ isLate(res.endDate) ? 'ATRASADO!' : 'No Prazo' }} <br>
             Vence em: {{ res.endDate | date:'dd/MM/yyyy' }}
          </p>

          <button class="btn-return" (click)="initiateReturn(res)">
            Devolver Livro
          </button>
        </div>
      </div>
    </div>
    <hr class="divider">
  </section>

  <div *ngIf="showFineModal" class="modal-overlay">
    <div class="modal-content">
      <h3>âš ï¸ Atraso Detectado</h3>
      <p>O livro <strong>{{ selectedReservation?.book?.title }}</strong> estÃ¡ atrasado.</p>
      <p>Para devolver, Ã© necessÃ¡rio pagar a taxa de:</p>
      
      <div class="fine-value">
        {{ fineSimulation | currency:'BRL' }}
      </div>

      <div class="modal-actions">
        <button class="btn-secondary" (click)="closeModal()">Cancelar</button>
        <button class="btn-primary" (click)="confirmReturn(selectedReservation.id)">
          Pagar e Devolver
        </button>
      </div>
    </div>
  </div>

  <h2>ğŸ” Acervo DisponÃ­vel</h2>
  
  <div *ngIf="books.length === 0" class="empty-state">
    <p>Carregando acervo...</p>
  </div>

  <div class="grid">
    <div *ngFor="let book of books" class="card">
      <img [src]="book.imageUrl" [alt]="book.title" class="book-cover">
      
      <div class="card-body">
        <h3>{{ book.title }}</h3>
        <p class="author">{{ book.author }}</p>
        
        <span [class.available]="book.isAvailable" 
              [class.unavailable]="!book.isAvailable"
              class="badge">
          {{ book.isAvailable ? 'DisponÃ­vel' : 'IndisponÃ­vel' }}
        </span>

        <button class="btn-primary" 
                [disabled]="!book.isAvailable"
                (click)="reserve(book)">
          {{ book.isAvailable ? 'Reservar' : 'Reservado' }}
        </button>
      </div>
    </div>
  </div>
</div>

<aside class="sidebar" [class.open]="isSidebarOpen">
  <div class="sidebar-header">
    <h2>Minha Conta</h2>
    <button class="close-btn" (click)="toggleSidebar()">âœ•</button>
  </div>

  <div class="profile-summary" *ngIf="userProfile">
    <h3>{{ userProfile.name }}</h3>
    <p class="email">{{ userProfile.email }}</p>
    <div class="cpf-badge">CPF: {{ userProfile.cpf }}</div>
  </div>

  <nav class="sidebar-menu">
    <button class="menu-item" (click)="openModal('NAME')">âœï¸ Editar Nome</button>
    <button class="menu-item" (click)="openModal('EMAIL')">ğŸ“§ Editar Email</button>
    <button class="menu-item" (click)="openModal('PASSWORD')">ğŸ”’ Trocar Senha</button>
    <hr>
    <button class="menu-item text-danger" (click)="openModal('DELETE')">ğŸ—‘ï¸ Excluir Conta</button>
  </nav>

  <div class="sidebar-footer">
    <button (click)="logout()" class="btn-logout">Sair da Conta</button>
  </div>
</aside>

<div class="overlay" 
     *ngIf="isSidebarOpen || (activeModal !== 'NONE' && activeModal !== 'FINE')" 
     (click)="isSidebarOpen = false; closeAllModals()">
</div>

<div class="modal-overlay" *ngIf="activeModal !== 'NONE' && activeModal !== 'FINE'">
  <div class="modal-content">
    
    <h3 *ngIf="activeModal === 'NAME'">Alterar Nome</h3>
    <h3 *ngIf="activeModal === 'EMAIL'">Alterar Email</h3>
    <h3 *ngIf="activeModal === 'PASSWORD'">Alterar Senha</h3>
    <h3 *ngIf="activeModal === 'DELETE'" style="color:red">Excluir Conta</h3>

    <div class="form-body">
      
      <div *ngIf="activeModal === 'NAME'">
        <input type="text" [(ngModel)]="formData.newName" placeholder="Novo nome completo">
      </div>

      <div *ngIf="activeModal === 'EMAIL'">
        <input type="email" [(ngModel)]="formData.newEmail" placeholder="Novo email">
      </div>

      <div *ngIf="activeModal === 'PASSWORD'">
        <input type="password" [(ngModel)]="formData.newPassword" placeholder="Nova senha">
        <input type="password" [(ngModel)]="formData.confirmNewPassword" placeholder="Confirme a nova senha">
      </div>

      <div *ngIf="activeModal === 'DELETE'">
        <p>Tem certeza? Isso apagarÃ¡ seu histÃ³rico de leitura para sempre.</p>
      </div>

      <hr>
      <label style="display:block; text-align:left; margin-bottom:5px; font-size:0.9rem">Confirme sua Senha Atual:</label>
      <input type="password" [(ngModel)]="formData.currentPassword" placeholder="Senha atual">
      
      <div class="modal-actions">
        <button class="btn-secondary" (click)="closeAllModals()">Cancelar</button>
        
        <button *ngIf="activeModal !== 'DELETE'" class="btn-primary" (click)="submitUpdate()">Salvar</button>
        <button *ngIf="activeModal === 'DELETE'" class="btn-danger" (click)="submitDelete()">Confirmar ExclusÃ£o</button>
      </div>
    </div>
  </div>
</div>